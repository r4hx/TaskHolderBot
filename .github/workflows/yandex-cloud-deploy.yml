name: Yandex.Cloud CI
on: push

jobs:
  linting:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - uses: actions/setup-python@v1
      - uses: whynothugo/python-linting@master
  testing:
    needs: [linting]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - uses: actions/setup-python@v1
        with:
          python-version: '3.8'
          architecture: 'x64'
      - name: Discovering test
        run: python3 -m unittest discover -v tests/
  deploy:
    needs: [linting, testing]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - uses: goodsmileduck/yandex-serverless-action@master
        with:
          source: '.'
          function_id: ${{ secrets.YC_FUNCTION_ID }}
          runtime: 'python37'
          entrypoint: 'main.handler'
          environment: DEBUG=True
          cloud_id: ${{ secrets.YC_CLOUD_ID }}
          folder_id: ${{ secrets.YC_FOLDER_ID }}
          token: ${{ secrets.YC_TOKEN }}
          bucket: ${{ secrets.YC_BUCKET }}
